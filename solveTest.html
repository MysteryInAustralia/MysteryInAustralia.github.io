<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scavenger Hunt</title>
	<link id="originalStylesheet" rel="stylesheet" type="text/css" href="styles.css">
	<link id="darkModeStylesheet" rel="stylesheet" type="text/css" href="dark.css" disabled>
</head>
<body>

<div id="page-container">
	<div class="main-content">
		<button id="menu-toggle" class="hamburger-menu">
			&#9776; Menu
		</button>
		<div class="menu">
			<div class="menu-item">
				<a href="/index.html" class="menu-link">Start</a>
			</div>
			<div class="menu-item">
				<a href="#" class="menu-link">Sydney</a>
				<div class="submenu">
					<a href="/wwInfo.html">Writers Walk Info</a>
					<a href="/ww1.html" class="link-ww1">Writers Walk 1</a>
					<a href="/ww2.html" class="link-ww2">Writers Walk 2</a>
					<a href="/ww3.html" class="link-ww3">Writers Walk 3</a>
					<a href="/ww4.html" class="link-ww4">Writers Walk 4</a>
					<a href="/ww5.html" class="link-ww5">Writers Walk 5</a>
					<a href="/observatory.html" class="locked-link link-observatory">Observatory Hill</a>
					<a href="/opera.html" class="locked-link link-opera">Sydney Opera House</a>
					<a href="/botanic.html" class="locked-link link-botanic">Royal Botanic Gardens</a>
					<a href="/pet.html" class="locked-link link-pet">Flinder's Pet</a>
					<a href="/hyde.html" class="locked-link link-hyde">Hyde Park</a>
					<a href="/rocks.html" class="locked-link link-rocks">The Rocks</a>
					<a href="/manly.html" class="locked-link link-manly">Manly Cove</a>
				</div>
			</div>

			<div class="menu-item">
				<a href="#" class="menu-link">Blue Mountains</a>
				<div class="submenu">
					<a href="/echoPoint.html" class="locked-link link-echoPoint">Echo Point</a>
					<a href="/elizabeth.html" class="locked-link link-elizabeth">Queen Elizabeth Lookout</a>
					<a href="/cahill.html" class="locked-link link-cahill">Cahill's Lookout</a>
				</div>
			</div>
			
			<div class="menu-item">
				<a href="/solve.html" class="menu-link">Final Question</a>
			</div>
		</div>

		<div class="content-wrap">
		 <h1>Final Question</h1> <!-- XXX --> 
			<!-- Bild für die Frage -->
			<img src="pic/questionMark.jpg" alt="image" class="question-image" id="fullscreenImage"> <!-- XXX --> 
			<br><br>
				<!-- Frage -->  
			<div class="letters-container">
				<div class="letter-group">
					<span data-letter="A" class="mystery-letter" id="letter01">?</span>
					<span data-letter="B" class="mystery-letter" id="letter02">?</span>
					<span data-letter="A" class="mystery-letter" id="letter03">?</span>
					<span data-letter="B" class="mystery-letter" id="letter04">?</span>
					<span data-letter="A" class="mystery-letter" id="letter05">?</span>
					<span data-letter="B" class="mystery-letter" id="letter06">?</span>
				</div>
				<div class="letter-group">
					<span data-letter="A" class="mystery-letter" id="letter07">?</span>
					<span data-letter="B" class="mystery-letter" id="letter08">?</span>
				</div>
				<div class="letter-group">
					<span data-letter="A" class="mystery-letter" id="letter09">?</span>
					<span data-letter="B" class="mystery-letter" id="letter10">?</span>
					<span data-letter="A" class="mystery-letter" id="letter11">?</span>
					<span data-letter="B" class="mystery-letter" id="letter12">?</span>
				</div>
				<div class="letter-group">
					<span data-letter="A" class="mystery-letter" id="letter13">?</span>
					<span data-letter="B" class="mystery-letter" id="letter14">?</span>
					<span data-letter="A" class="mystery-letter" id="letter15">?</span>
					<span data-letter="B" class="mystery-letter" id="letter16">?</span>
					<span data-letter="A" class="mystery-letter" id="letter17">?</span>
					<span data-letter="B" class="mystery-letter" id="letter18">?</span>
					<span data-letter="A" class="mystery-letter" id="letter19">?</span>
					<span data-letter="B" class="mystery-letter" id="letter20">?</span>
					<span data-letter="A" class="mystery-letter" id="letter21">?</span>
				</div>
			</div>
	
			
		</div>
	</div>
		

	<!-- Der Footer -->
	<div class="footer">
		<a href="#">About us</a>
		<a href="#">Destinations</a>
		<a href="#">Travel Tips</a>
		<a href="#">Contact us</a>
		<a href="/credits.html">Image Credits</a>
		<a href="#">Terms and Conditions</a>
	</div>
</div>

<div id="popupOverlay" class="popup-overlay">
    <div class="popup-content">
        <span class="popup-close-btn" onclick="closePopup()">&times;</span>
        <p>You did it!<br>
		   You really solved all the riddles and unlocked all letters!<br><br>
		   Now to get to the final question you still need to decode the letters.<br>
		   Our detective for recherche and archive developed a special tool and installed it on your phone.<br><br>
		   All you need to do to decode the letters is click on each letter a few times.<br>
		   The unlocking tool will then switch the letters and recognize once it is correct.<br>
		   The letter will then change color and you will know it is decoded.<br>
		  <span class="hash white">#</span><span class="hash red">#</span><span class="hash blue">#</span>
			</p>
    </div>
</div>

<script>
	document.body.classList.remove("transition-background");

	document.addEventListener('DOMContentLoaded', function() {
		// Aktuellen Pfad der Webseite erhalten
		var currentPath = window.location.pathname;
		console.log(currentPath);
		// Alle Links in den Menüs abrufen
		var menuLinks = document.querySelectorAll('.menu a');

		menuLinks.forEach(function(link) {
			if (link.getAttribute('href') === currentPath) {
				// Den aktiven Link markieren
				link.classList.add('active-link');

				// Übergeordnetes Menüelement (falls vorhanden) finden und erweitern
				var parentMenu = link.closest('.submenu');
				if (parentMenu) {
					parentMenu.style.display = 'block';
				}
			}
		});
	});
	

	//Hamburger Menu
	document.addEventListener('DOMContentLoaded', function() 
	{
		var menuToggle = document.getElementById('menu-toggle');
		var menu = document.querySelector('.menu');
		
		if (menuToggle) 
		{
			menuToggle.addEventListener('click', function() 
			{
				if (menu.style.display === 'none' || menu.style.display === '') {
					menu.style.display = 'block';
				} else {
					menu.style.display = 'none';
				}
			});
		}
	});
	
	
	//Dark Mode check
	document.addEventListener('DOMContentLoaded', function() {
		if (localStorage.getItem("dark") === "true") {
			// Aktiviere die darkmode.css Datei.
			document.getElementById('darkModeStylesheet').removeAttribute('disabled');
			
			// Optional: Deaktiviere die ursprüngliche CSS-Datei, falls notwendig.
			 document.getElementById('originalStylesheet').setAttribute('disabled', true);
		}
	});
	
	function revealLetterForCondition(conditionKey, letterId, revealedLetter) {
    if (localStorage.getItem(conditionKey) === "true") {
        var letter = document.getElementById(letterId);
        letter.textContent = revealedLetter;
        letter.classList.add('revealed');
    }
}
	
	//Color answered Links
	if (localStorage.getItem("ww1") === "true")
	{
		document.querySelector('.link-ww1').classList.add('correct-link'); //Green Checkmark
		revealLetterForCondition("ww1", "letter01", "Z");
	}
	if (localStorage.getItem("ww2") === "true")
	{
		document.querySelector('.link-ww2').classList.add('correct-link'); //Green Checkmark
		revealLetterForCondition("ww2", "letter02", "L");
		revealLetterForCondition("ww2", "letter10", "L");
		revealLetterForCondition("ww2", "letter15", "L");
	}
	if (localStorage.getItem("ww3") === "true")
	{
		document.querySelector('.link-ww3').classList.add('correct-link'); //Green Checkmark
		revealLetterForCondition("ww3", "letter03", "O");
		revealLetterForCondition("ww3", "letter04", "O");
	}
	if (localStorage.getItem("ww4") === "true")
	{
		document.querySelector('.link-ww4').classList.add('correct-link'); //Green Checkmark
		revealLetterForCondition("ww4", "letter05", "V");
	}
	if (localStorage.getItem("ww5") === "true")
	{
		document.querySelector('.link-ww5').classList.add('correct-link'); //Green Checkmark
		revealLetterForCondition("ww5", "letter06", "W");
		revealLetterForCondition("ww5", "letter18", "W");
	}
	if (localStorage.getItem("observatory") === "true")
	{
		document.querySelector('.link-observatory').classList.add('correct-link'); //Green Checkmark
		revealLetterForCondition("observatory", "letter07", "G");
	}
	if (localStorage.getItem("opera") === "true")
	{
		document.querySelector('.link-opera').classList.add('correct-link'); //Green Checkmark
		revealLetterForCondition("opera", "letter08", "X");
	}
	if (localStorage.getItem("botanic") === "true")
	{
		document.querySelector('.link-botanic').classList.add('correct-link'); //Green Checkmark
		revealLetterForCondition("botanic", "letter09", "P");
	}
	if (localStorage.getItem("pet") === "true")
	{
		document.querySelector('.link-pet').classList.add('correct-link'); //Green Checkmark
		revealLetterForCondition("pet", "letter11", "F");
	}
	if (localStorage.getItem("hyde") === "true")
	{
		document.querySelector('.link-hyde').classList.add('correct-link'); //Green Checkmark
		revealLetterForCondition("hyde", "letter12", "K");
		revealLetterForCondition("hyde", "letter13", "K");
	}
	if (localStorage.getItem("rocks") === "true")
	{
		document.querySelector('.link-rocks').classList.add('correct-link'); //Green Checkmark
		revealLetterForCondition("rocks", "letter14", "H");
	}
	if (localStorage.getItem("manly") === "true")
	{
		document.querySelector('.link-manly').classList.add('correct-link'); //Green Checkmark
		revealLetterForCondition("manly", "letter16", "U");
	}
	if (localStorage.getItem("echoPoint") === "true")
	{
		document.querySelector('.link-echoPoint').classList.add('correct-link'); //Green Checkmark
		revealLetterForCondition("echoPoint", "letter17", "D");
	}
	if (localStorage.getItem("elizabeth") === "true")
	{
		document.querySelector('.link-elizabeth').classList.add('correct-link'); //Green Checkmark
		revealLetterForCondition("elizabeth", "letter19", "H");
	}
	if (localStorage.getItem("cahill") === "true")
	{
		document.querySelector('.link-cahill').classList.add('correct-link'); //Green Checkmark
		revealLetterForCondition("cahill", "letter20", "Q");
	}
	
	//Check if all is solved
	if (localStorage.getItem("ww1") === "true" &&
		localStorage.getItem("ww2") === "true" &&
		localStorage.getItem("ww3") === "true" &&
		localStorage.getItem("ww4") === "true" &&
		localStorage.getItem("ww5") === "true" &&
		localStorage.getItem("observatory") === "true" &&
		localStorage.getItem("opera") === "true" &&
		localStorage.getItem("botanic") === "true" &&
		localStorage.getItem("pet") === "true" &&
		localStorage.getItem("hyde") === "true" &&
		localStorage.getItem("rocks") === "true" &&
		localStorage.getItem("manly") === "true" &&
		localStorage.getItem("echoPoint") === "true" &&
		localStorage.getItem("elizabeth") === "true" &&
		localStorage.getItem("cahill") === "true")
	{
		localStorage.setItem("allSolved", "true");
		//openPopup();
	}
	
	if(localStorage.getItem("allSolved") === "true")
	{
		openPopup();
	}
	
	if(localStorage.getItem("allSolved") === "true") {
		document.addEventListener("DOMContentLoaded", function() {
			var dependencies = {
							"letter01": {next: 'W', dependsOn: null},
							"letter02": {next: 'I', dependsOn: "letter13"},
							"letter03": {next: 'L', dependsOn: "letter07"},
							"letter04": {next: 'L', dependsOn: "letter11"},
							"letter05": {next: 'S', dependsOn: "letter04"},
							"letter06": {next: 'T', dependsOn: "letter15"},
							"letter07": {next: 'D', dependsOn: "letter16"},
							"letter08": {next: 'U', dependsOn: "letter01"},
							"letter09": {next: 'M', dependsOn: "letter17"},
							"letter10": {next: 'I', dependsOn: "letter05"},
							"letter11": {next: 'C', dependsOn: "letter02"},
							"letter12": {next: 'H', dependsOn: "letter08"},
							"letter13": {next: 'H', dependsOn: "letter18"},
							"letter14": {next: 'E', dependsOn: "letter14"},  // Es wurde keine Abhängigkeit angegeben, also ist es null
							"letter15": {next: 'I', dependsOn: "letter03"},
							"letter16": {next: 'R', dependsOn: "letter10"},
							"letter17": {next: 'A', dependsOn: "letter09"},
							"letter18": {next: 'T', dependsOn: "letter19"},
							"letter19": {next: 'E', dependsOn: "letter06"},
							"letter20": {next: 'N', dependsOn: "letter12"}
						};

			for (var letterId in dependencies) {
				(function(letterId) {
					var letterElement = document.getElementById(letterId);
					var config = dependencies[letterId];
					var dependedElement = document.getElementById(config.dependsOn);
					
					if (config.dependsOn === null || (dependedElement && dependedElement.classList.contains('mystery-letter-solved'))) {
						letterElement.classList.remove('revealed');
						letterElement.classList.add('mystery-letter-active');

						letterElement.addEventListener("click", function listener() {
							var currentLetter = letterElement.textContent;
							var nextLetter = getNextLetter(currentLetter);
							letterElement.textContent = nextLetter;

							if (nextLetter === config.next) {
								letterElement.classList.remove('mystery-letter-active');
								letterElement.classList.add('mystery-letter-solved');
								letterElement.removeEventListener('click', listener);
								countSolvedLetters();
							}
						});
					}
				})(letterId);
			}
		});
	}
	
	function getNextLetter(letter) {
		if (letter === 'A') {  // Falls der aktuelle Buchstabe Z ist, zum Anfang (A) zurückkehren
			return 'Z';
		}
		// String.fromCharCode() gibt den Zeichen-String aus seinem UTF-16-Code zurück.
		// charCodeAt() gibt den UTF-16-Code des Zeichens am angegebenen Index zurück.
		return String.fromCharCode(letter.charCodeAt(0) - 1);
	}
	
	function countSolvedLetters() {
		var solvedLetters = document.querySelectorAll('.mystery-letter-solved');
		if(solvedLetters.length === 20)
		{
			var imageElement = document.getElementById('fullscreenImage');
			imageElement.src = '/pic/IMG_20220927_122911.jpg';
		}
	}
	
	function openPopup() {
		document.getElementById('popupOverlay').style.display = 'block';
	}

	function closePopup() {
		document.getElementById('popupOverlay').style.display = 'none';
	}
</script>


</body>
</html>
